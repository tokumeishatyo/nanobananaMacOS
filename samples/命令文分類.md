# 命令文の分類（Step 2）

命令文を以下の3カテゴリに分類:
- **全共通**: 全ての出力タイプで使用すべき
- **三面図系共通**: 顔三面図(01)、素体三面図(02)、衣装着用(03)で共通
- **機能固有**: 特定の出力タイプでのみ使用

---

## A. 全共通（10種類すべてで使用すべき）

### A1. output_cleanliness セクション（必須）

全出力タイプで以下の命令文を含めるべき:

```yaml
output_cleanliness:
  - "Output ONLY the [対象] - nothing else"
  - "Do NOT add any text, titles, labels, or annotations"
  - "Do NOT add color palettes, color swatches, or color samples"
  - "Do NOT add arrows, lines, or any explanatory graphics"
  - "Do NOT add watermarks, signatures, or logos"
  - "The output must contain ONLY [対象] on [背景]"
```

**[対象]と[背景]の置換表:**
| 出力タイプ | [対象] | [背景] |
|-----------|--------|--------|
| 01 顔三面図 | the face reference sheet | white background |
| 02 素体三面図 | the body reference sheet | white background |
| 03 衣装着用 | the outfit reference sheet | white background |
| 04 ポーズ | the character illustration | specified background |
| 05 シーン | the scene illustration | - |
| 06 背景 | the background image | - |
| 07 装飾テキスト | the decorative text | transparent background |
| 08 4コマ | the manga panels | - |
| 09 スタイル変換 | the chibi character | specified background |
| 10 インフォグラフィック | the infographic | - |

### A2. 基本メタ情報（必須）

全出力タイプで含めるべき:

```yaml
type: [出力タイプ識別子]
title: "[タイトル]"
author: "[作者名]"
```

### A3. スタイルセクション（必須）

全出力タイプで末尾に配置:

```yaml
style:
  color_mode: "[カラーモード]"
  output_style: "[スタイル]"
  aspect_ratio: "[アスペクト比]"
```

### A4. title_overlay セクション（必須）

全出力タイプで含めるべき:

```yaml
title_overlay:
  enabled: true/false
  title:
    text: "[タイトル]"
    position: "top-left"
    font_size: "large"
  author:
    text: "[作者名]"
    position: "top-right"
    font_size: "small"
```

---

## B. 三面図系共通（01, 02, 03で共通）

### B1. レイアウト制約

```yaml
# 02, 03のみ（横一列配置）
constraints:
  layout:
    - "STRICT horizontal arrangement: LEFT=front view, CENTER=left side view, RIGHT=back view"
    - "POSITION ORDER IS CRITICAL: Front on LEFT, Side in CENTER, Back on RIGHT"
    - "Each view should be clearly separated with white space"
```

```yaml
# 01のみ（三角配置）
constraints:
  layout:
    - "Triangular arrangement: front view top-left, 3/4 left view top-right, left profile bottom-center"
    - "All angled views must face LEFT direction"
    - "Each view should be clearly separated with white space"
    - "All views same size and scale"
```

### B2. 横顔（サイドビュー）制約

```yaml
# 01, 02, 03で共通（表現を統一すべき）
anti_hallucination:
  - "Side view MUST be exactly 90-degree profile - only ONE eye visible"
  - "Side view MUST NOT show both eyes - if both eyes are visible, it is NOT a correct profile"
  - "Side view: nose must point directly to the left edge, ear fully visible"
```

### B3. 一貫性制約

```yaml
# 02, 03で共通
constraints:
  consistency:
    - "All three views must show the same character in same pose/outfit"
    - "Maintain consistent proportions across views"
    - "Clean linework suitable for reference"
```

### B4. ビュー順序（anti_hallucination）

```yaml
# 02, 03で共通
anti_hallucination:
  - "Do NOT change the view order - ALWAYS front/side/back from left to right"
```

---

## C. 機能固有（特定の出力タイプでのみ使用）

### C1. 顔三面図(01)専用

```yaml
constraints:
  face_specific:
    - "HEAD/FACE ONLY - show from top of head to neck/collarbone"
    - "Do NOT draw any clothing, accessories, or decorations"
    - "Keep the character in clean base body state"
    - "Neutral expression, emotionless"
    - "3/4 view: head turned 45 degrees to the LEFT"
    - "Profile view: MUST be exactly 90-degree side view facing LEFT"

anti_hallucination:
  - "Do NOT include character names on the image"
  - "Do NOT add view labels like 'FRONT VIEW' or 'SIDE VIEW'"
  - "Do NOT add borders or frames around views"
  - "Do NOT add any decorative elements"
  - "Output ONLY the character views on white background"
```

### C2. 素体三面図(02)専用

```yaml
constraints:
  body_generation:
    - "Generate body matching the specified body type"
    - "Do NOT add any clothing or accessories beyond specified render type"
    - "Maintain anatomically correct proportions"
  pose:
    - "Attention pose (kiwotsuke): standing straight with arms at sides"
    - "Heels together, toes slightly apart"
    - "Arms relaxed at sides, palms facing inward"
    - "Do NOT use T-pose or A-pose"

anti_hallucination:
  - "Do NOT change body proportions from specified type"
  - "Do NOT add clothing that was not specified"
  - "Do NOT add accessories or decorations"
  - "Do NOT use T-pose or A-pose - use attention pose only"
```

### C3. 衣装着用(03)専用

```yaml
constraints:
  body_preservation:
    - "MUST use exact body shape from input body_sheet"
    - "Do NOT alter body proportions or pose"
    - "Body should be visible through/under clothing naturally"
  outfit_application:
    - "Apply specified outfit to the body"
    - "Maintain clothing consistency across all three views"
    - "Show realistic fabric draping and fit"

anti_hallucination:
  - "Do NOT add accessories not specified in outfit"
  - "Do NOT change hair style or color"
  - "Apply ONLY the specified outfit"
```

### C4. ポーズ(04)専用

```yaml
constraints:
  character_preservation:
    - "Preserve exact character design, face, and colors from input image"
    - "Maintain clothing details exactly as shown in input"
  output_format:
    - "Single character image, full body visible"

anti_hallucination:
  - "Do NOT alter character design from input"
  - "Do NOT add extra figures"
```

### C5. シーン(05)専用

現状constraints/anti_hallucination/output_cleanlinessがない。
→ **追加が必要**

```yaml
# 追加推奨
constraints:
  - "Maintain character appearance exactly as shown in reference images"
  - "Follow the scene composition instructions precisely"

anti_hallucination:
  - "Do NOT change character designs from reference"
  - "Do NOT add characters not specified"

output_cleanliness:
  - "Output ONLY the scene illustration - nothing else"
  - "Do NOT add any text, titles, labels, or annotations"
  # ...（全共通と同じ）
```

### C6. 背景(06)専用

```yaml
constraints:
  - "Use the reference image as the base for the background"
  - "Apply the transformation instruction to modify the style/atmosphere"
  - "Do NOT include any characters or people in the output"
  - "Maintain the general composition and layout from the reference"
  - "Output aspect ratio: [aspect_ratio]"

output_cleanliness:
  # 追加で固有のもの
  - "Do NOT add location markers, arrows, or explanatory graphics"
```

### C7. 装飾テキスト(07)専用

現状constraints/anti_hallucination/output_cleanlinessがない。
→ **追加が必要**

```yaml
# 追加推奨
constraints:
  - "Create text exactly as specified in the settings"
  - "Apply specified effects and styling"

anti_hallucination:
  - "Do NOT alter the specified text content"
  - "Do NOT add decorations not specified"

output_cleanliness:
  - "Output ONLY the decorative text on transparent background"
  # ...（全共通と同じ）
```

### C8. 4コマ漫画(08)専用

現状constraints/anti_hallucination/output_cleanlinessがない。
→ **構造が特殊なため検討が必要**

```yaml
# 追加推奨
constraints:
  - "Maintain character appearances exactly as shown in reference images"
  - "Follow panel layout instructions precisely"
  - "Include all specified speech bubbles and narration"

anti_hallucination:
  - "Do NOT change character designs from reference"
  - "Do NOT omit any specified panels or dialog"
  - "Do NOT add panels or content not specified"
```

### C9. スタイル変換(09)専用

```yaml
constraints:
  chibi_rules:
    - "Transform to chibi style with [頭身] head-to-body ratio"
    - "Large head, small body, simplified features"
    - "Maintain character identity (face, hair, colors)"
    - "Keep the cuteness and appeal of chibi style"
  preservation_rules:
    - "Preserve: outfit and clothing, pose and action"
    - "Maintain the same outfit design (simplified for chibi proportions)"
    - "Keep the same pose action (adapted for chibi body)"
  style_consistency:
    - "Use consistent chibi proportions throughout"
    - "Clean, cute linework suitable for chibi style"
    - "Transparent background for easy compositing"

anti_hallucination:
  - "Do NOT change character's identity (face, hair color)"
  - "Do NOT add new accessories not in source"
  - "Do NOT change outfit design significantly"
  - "MAINTAIN chibi proportions consistently"

output_cleanliness:
  # 追加で固有のもの
  - "Do NOT add size comparison charts or reference guides"
```

### C10. インフォグラフィック(10)専用

```yaml
constraints:
  - "Use the provided character image as the main central figure"
  - "Arrange information sections around the character"
  - "Create appropriate icons and decorations based on content (AI decides)"
  - "Output all text in [output_language]"
  - "Maintain [style_type] style throughout"
  - "Aspect ratio: [aspect_ratio]"

anti_hallucination:
  - "Do NOT change the character's appearance from the provided image"
  - "Do NOT omit any of the specified sections"
  - "Do NOT add unrelated information not in the sections"
```

---

## D. 分類サマリー

### 全共通セクション（必須）
| セクション | 内容 |
|-----------|------|
| type | 出力タイプ識別子 |
| title | タイトル |
| author | 作者名 |
| style | カラーモード、スタイル、アスペクト比 |
| output_cleanliness | クリーン出力命令（6項目） |
| title_overlay | オーバーレイ設定 |

### 三面図系共通セクション（01, 02, 03）
| セクション | 内容 |
|-----------|------|
| constraints.layout | レイアウト配置制約 |
| constraints.consistency | 一貫性制約 |
| anti_hallucination | 横顔・ビュー順序制約 |

### 機能固有セクション
| 出力タイプ | 固有セクション |
|-----------|---------------|
| 01 顔三面図 | face_specific |
| 02 素体三面図 | body_generation, pose |
| 03 衣装着用 | body_preservation, outfit_application |
| 04 ポーズ | character_preservation, output_format |
| 05 シーン | （追加が必要） |
| 06 背景 | 背景固有の制約 |
| 07 装飾テキスト | （追加が必要） |
| 08 4コマ漫画 | （特殊構造） |
| 09 スタイル変換 | chibi_rules, preservation_rules, style_consistency |
| 10 インフォグラフィック | インフォグラフィック固有の制約 |

---

## E. 問題点と改善案

### E1. 欠落しているセクション

| 出力タイプ | 欠落 | 対応 |
|-----------|------|------|
| 05 シーン | type, constraints, anti_hallucination, output_cleanliness | 追加必要 |
| 07 装飾テキスト | title, author, constraints, anti_hallucination, output_cleanliness, title_overlay | 追加必要 |
| 08 4コマ | type, style, constraints, anti_hallucination, output_cleanliness | 追加必要 |

### E2. 表現の不統一

1. **横顔表現**: "Profile view" vs "Side view" → 統一すべき
2. **顔保持表現**: 02と03で同じ意図だが文言が微妙に異なる → 統一すべき

### E3. 重複している命令文

`output_cleanliness`の6項目は全機能で同一なので、テンプレート化が有効。
