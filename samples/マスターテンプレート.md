# マスターテンプレート構造設計（Step 3）

## 基本構造

すべてのYAMLは以下の順序でセクションを配置する。

```
1. 冒頭説明コメント
2. Title Elements（type, title, author）
3. Title Overlay
4. Style Settings
5. 機能固有セクション（出力タイプにより異なる）
6. Generation Instructions（動的生成指示 - 一部の出力タイプのみ）
7. Constraints
8. Anti-Hallucination
9. Output Cleanliness
```

**注:** Generation Instructionsは08(4コマ漫画)と10(インフォグラフィック)でのみ使用。

---

## 1. 冒頭説明コメント（全共通）

各出力タイプの冒頭に配置する説明文。

```yaml
# ====================================================
# 顔三面図 (Face Character Reference Sheet)
# キャラクターの顔を正面・斜め・横の3方向から描いた設定画
# ====================================================
```

### 各出力タイプの冒頭説明

| 出力タイプ | 日本語名 | 英語名 | 説明 |
|-----------|---------|--------|------|
| 01 | 顔三面図 | Face Character Reference Sheet | キャラクターの顔を正面・斜め・横の3方向から描いた設定画 |
| 02 | 素体三面図 | Body Reference Sheet | キャラクターの素体を正面・横・背面の3方向から描いた設定画 |
| 03 | 衣装着用三面図 | Outfit Reference Sheet | 衣装を着用したキャラクターを正面・横・背面の3方向から描いた設定画 |
| 04 | ポーズ | Pose Illustration | キャラクターにポーズを付けた1枚絵 |
| 05 | シーンビルダー | Scene Illustration | キャラクターを配置したシーン画像 |
| 06 | 背景生成 | Background Generation | 参考画像から背景画像を生成 |
| 07 | 装飾テキスト | Decorative Text | スタイリッシュな装飾テキスト画像 |
| 08 | 4コマ漫画 | Four Panel Manga | 4コマ形式の漫画画像 |
| 09 | スタイル変換 | Style Transform | 既存画像を別スタイルに変換 |
| 10 | インフォグラフィック | Infographic | キャラクター紹介用のインフォグラフィック |

---

## 2. Title Elements（全共通）

```yaml
# ====================================================
# Title Elements
# ====================================================
type: [出力タイプ識別子]
title: "[タイトル]"
author: "[作者名]"
```

### type値一覧

| 出力タイプ | type値 |
|-----------|--------|
| 01 | character_design |
| 02 | body_reference_sheet |
| 03 | outfit_reference_sheet |
| 04 | pose_illustration |
| 05 | scene_illustration |
| 06 | background_generation |
| 07 | decorative_text |
| 08 | four_panel_manga |
| 09 | style_transform |
| 10 | infographic |

---

## 3. Title Overlay（全共通）

```yaml
# ====================================================
# Title Overlay
# ====================================================
title_overlay:
  enabled: true
  title:
    text: "[タイトル]"
    position: "top-left"
    font_size: "large"
  author:
    text: "[作者名]"
    position: "top-right"
    font_size: "small"
```

---

## 4. Style Settings（全共通）

```yaml
# ====================================================
# Style Settings
# ====================================================
style:
  color_mode: "[fullcolor / monochrome / sepia]"
  output_style: "[anime / pixel_art / chibi / realistic / etc.]"
  aspect_ratio: "[1:1 / 16:9 / 9:16 / 4:3 / 3:4]"
```

---

## 5. 機能固有セクション

### 5.1 顔三面図 (01)

```yaml
# ====================================================
# Output Type
# ====================================================
output_type: "face character reference sheet"

# ====================================================
# Layout
# ====================================================
layout:
  arrangement: "triangular, inverted triangle formation"
  direction: "all views facing LEFT"
  top_row:
    - position: "top-left"
      view: "front view"
    - position: "top-right"
      view: "3/4 left view (head turned 45 degrees to the left)"
  bottom_row:
    - position: "bottom-center"
      view: "left profile (90-degree side view, facing left)"

# ====================================================
# Headshot Specification
# ====================================================
headshot_specification:
  type: "headshot only"
  coverage: "From top of head to base of neck/collarbone area"
  exclude: "No shoulders, no body, no clothing"

# ====================================================
# Character
# ====================================================
character:
  name: "[キャラクター名]"
  description: "[外見説明]"
  outfit: "NONE - bare skin only, no clothing"
  expression: "neutral expression"

# ====================================================
# Character Style
# ====================================================
character_style:
  style: "[スタイル説明]"
  proportions: "Normal head-to-body ratio (6-7 heads)"

# ====================================================
# Output
# ====================================================
output:
  format: "reference sheet with multiple views"
  views: "front view, 3/4 view, side profile"
  background: "pure white"
```

### 5.2 素体三面図 (02)

```yaml
# ====================================================
# Input
# ====================================================
input:
  face_sheet: "[顔三面図ファイル名]"
  instruction: "Use the face from this reference sheet"

# ====================================================
# Output Type
# ====================================================
output_type: "body reference sheet (white background)"

# ====================================================
# Layout
# ====================================================
layout:
  arrangement: "horizontal, left to right"
  views:
    - position: "left"
      type: "front view"
    - position: "center"
      type: "left side view (90-degree profile, facing left)"
    - position: "right"
      type: "back view"

# ====================================================
# Body Specification
# ====================================================
body_specification:
  type: "full body character design base body"
  coverage: "Full body from head to feet"
  pose: "attention pose (kiwotsuke)"
  render_type: "[nude / underwear / swimsuit]"

# ====================================================
# Character
# ====================================================
character:
  name: "[キャラクター名]"
  face_reference: "MUST use exact face from input face_sheet"
  body_type: "[体型]"
  bust_type: "[バストサイズ]"

# ====================================================
# Character Style
# ====================================================
character_style:
  style: "[スタイル説明]"
  proportions: "Normal head-to-body ratio (6-7 heads)"

# ====================================================
# Output
# ====================================================
output:
  format: "reference sheet with three views"
  background: "pure white"
```

### 5.3 衣装着用三面図 (03)

```yaml
# ====================================================
# Input
# ====================================================
input:
  body_sheet: "[素体三面図ファイル名]"
  instruction: "Use the body and face from this reference sheet"

# ====================================================
# Output Type
# ====================================================
output_type: "outfit reference sheet (white background)"

# ====================================================
# Layout
# ====================================================
layout:
  arrangement: "horizontal, left to right"
  views:
    - position: "left"
      type: "front view"
    - position: "center"
      type: "left side view (90-degree profile, facing left)"
    - position: "right"
      type: "back view"

# ====================================================
# Outfit Configuration (プリセットモード)
# ====================================================
outfit:
  category: "[カテゴリ]"
  shape: "[形状]"
  color: "[色]"
  pattern: "[柄]"
  impression: "[印象]"
  headwear_option: "[頭部装飾オプション]"

# または

# ====================================================
# Outfit Reference (参考画像モード)
# ====================================================
outfit_reference:
  image: "[参考画像ファイル名]"
  fit_mode: "[フィットモード]"
  headwear_option: "[頭部装飾オプション]"

# ====================================================
# Character
# ====================================================
character:
  name: "[キャラクター名]"
  body_reference: "MUST use exact body and face from input body_sheet"

# ====================================================
# Character Style
# ====================================================
character_style:
  style: "[スタイル説明]"
  proportions: "Normal head-to-body ratio (6-7 heads)"

# ====================================================
# Output
# ====================================================
output:
  format: "reference sheet with three views"
  background: "pure white"
```

### 5.4 ポーズ (04)

```yaml
# ====================================================
# Input
# ====================================================
input:
  outfit_sheet: "[衣装着用三面図ファイル名]"
  instruction: "Use this character with their outfit"

# ====================================================
# Pose Configuration (プリセットモード)
# ====================================================
pose:
  preset: "[ポーズプリセット]"
  camera_angle: "[カメラアングル]"

# または

# ====================================================
# Pose Reference (参考画像モード)
# ====================================================
pose_reference:
  image: "[参考画像ファイル名]"
  instruction: "Capture pose from this reference"

# ====================================================
# Scene
# ====================================================
scene:
  background: "[背景説明]"
  lighting: "[ライティング]"

# ====================================================
# Output
# ====================================================
output:
  format: "single character illustration"
  background: "[背景]"
```

### 5.5 シーンビルダー (05)

```yaml
# ====================================================
# Scene Type
# ====================================================
scene_type: "[story / battle / boss_raid]"

# ====================================================
# Characters
# ====================================================
characters:
  - name: "[キャラクター名]"
    reference: "[参考画像]"
    position: "[配置]"
    action: "[アクション]"

# ====================================================
# Scene Configuration
# ====================================================
scene:
  background: "[背景説明]"
  atmosphere: "[雰囲気]"
  composition: "[構図]"

# ====================================================
# Decorative Text (オプション)
# ====================================================
decorative_text:
  enabled: true/false
  text: "[テキスト]"
  style: "[スタイル]"
  position: "[配置]"
```

### 5.6 背景生成 (06)

```yaml
# ====================================================
# Input
# ====================================================
input:
  reference_image: "[参考画像ファイル名]"
  use_reference: true/false

# ====================================================
# Background Configuration
# ====================================================
background:
  description: "[背景説明]"
  transformation: "[変換指示]"
```

### 5.7 装飾テキスト (07)

```yaml
# ====================================================
# Text Configuration
# ====================================================
text:
  content: "[テキスト内容]"

# ====================================================
# Text Style
# ====================================================
text_style:
  preset: "[プリセット]"
  font_type: "[フォントタイプ]"
  size: "[サイズ]"
  fill_color: "[塗り色]"
  outline:
    enabled: true/false
    color: "[アウトライン色]"
    thickness: "[太さ]"
  effects:
    glow: "[グロー効果]"
    shadow: "[影効果]"

# ====================================================
# Output
# ====================================================
output:
  background: "transparent"
```

### 5.8 4コマ漫画 (08)

**注:** 4コマ漫画はYAMLの前にAI向けヘッダー指示文が入る特殊な形式。

```yaml
# ====================================================
# Generation Instructions (YAML外ヘッダー)
# ====================================================
# 以下の固定文がYAMLの前に出力される:
#
# 【画像生成指示 / Image Generation Instructions】
# 以下のYAML指示に従って、4コマ漫画を1枚の画像として生成してください。
# 添付したキャラクター設定画を参考に、キャラクターの外見を一貫させてください。
#
# Generate a 4-panel manga as a single image following the YAML instructions below.
# Use the attached character reference sheets to maintain consistent character appearances.
#
# ---

# ====================================================
# Characters
# ====================================================
characters:
  - name: "[キャラクター名]"
    reference: "[参考画像]"
    description: "[説明]"

# ====================================================
# Panels
# ====================================================
panels:
  - panel_number: 1
    prompt: "[場面説明]"
    speeches:
      - character: "[キャラクター名]"
        content: "[セリフ]"
        position: "[位置]"
    narration: "[ナレーション]"
  # ... 2, 3, 4コマ

# ====================================================
# Layout
# ====================================================
layout:
  arrangement: "vertical (top to bottom)"
  aspect_ratio: "9:16 or 2:5"
```

### 5.9 スタイル変換 (09)

```yaml
# ====================================================
# Input
# ====================================================
input:
  source_image: "[変換元画像ファイル名]"

# ====================================================
# Transform Configuration
# ====================================================
transform:
  type: "[chibi / pixel_art / realistic / etc.]"
  style_prompt: "[スタイル詳細説明]"

# ====================================================
# Preservation Settings
# ====================================================
preserve:
  face_features: true
  outfit_details: true
  pose_action: true

# ====================================================
# Output
# ====================================================
output:
  background: "[transparent / white / etc.]"
```

### 5.10 インフォグラフィック (10)

```yaml
# ====================================================
# Style Configuration
# ====================================================
infographic_style:
  type: "[graphic_recording / magazine / etc.]"
  style_prompt: "[スタイル詳細説明]"
  output_language: "[Japanese / English]"

# ====================================================
# Titles
# ====================================================
titles:
  main_title: "[メインタイトル]"
  subtitle: "[サブタイトル]"

# ====================================================
# Main Character
# ====================================================
main_character:
  image: "[キャラクター画像]"
  position: "center"

# ====================================================
# Bonus Character (オプション)
# ====================================================
bonus_character:
  enabled: true/false
  image: "[ボーナスキャラ画像]"

# ====================================================
# Information Sections
# ====================================================
sections:
  - title: "[セクションタイトル]"
    content: "[内容]"
  # ... 複数セクション

# ====================================================
# Generation Instructions (動的生成)
# ====================================================
prompt: |
  Create a detailed infographic about this person/character in [スタイル] style.
  Use the attached character image as the central figure.
  Include extremely detailed information - small text is acceptable if it adds more detail.

  Style: [スタイルプロンプト]

  Main title: "[タイトル]"
  Subtitle: "[サブタイトル]"

  Include these sections around the character:
  - [セクション1タイトル]: [内容]
  - [セクション2タイトル]: [内容]
  ...

  Output language: [言語]

  IMPORTANT:
  - Create related icons and decorations automatically based on the content
  - Use the [スタイル] visual style consistently
  - Make it visually engaging with colors, icons, and artistic elements
  - Include as much detail as possible in small organized sections
```

---

## 6. Generation Instructions（動的生成指示）

一部の出力タイプでは、ユーザー入力を統合した動的な指示文を生成する。

### 6.1 対象出力タイプ

| 出力タイプ | 形式 | 内容 |
|-----------|------|------|
| 08 4コマ漫画 | YAML外ヘッダー | 固定の日英指示文（YAMLの前に出力） |
| 10 インフォグラフィック | promptフィールド | 設定内容を統合した動的指示文 |

### 6.2 配置位置

```yaml
# 機能固有セクション（Input, Characters, etc.）の後
# Constraintsの前

# ====================================================
# Generation Instructions
# ====================================================
prompt: |
  [動的に生成される指示文]
```

### 6.3 目的

- **4コマ漫画**: AIに「このYAMLは4コマ漫画の指示である」ことを明示
- **インフォグラフィック**: セクション情報を自然言語で統合し、AIが理解しやすい形式で提供

---

## 7. Constraints（出力タイプ別）

### 7.1 共通制約（全出力タイプ）

なし（機能固有のみ）

### 7.2 三面図系共通制約 (01, 02, 03)

```yaml
# ====================================================
# Constraints
# ====================================================
constraints:
  layout:
    - "Each view should be clearly separated with white space"
    - "Clean linework suitable for reference"
  side_view:
    - "Side view MUST be exactly 90-degree profile"
    - "Side view MUST show LEFT side (character facing left)"
    - "Side view: only ONE eye visible"
    - "Side view: nose points directly to the left edge, ear fully visible"
```

### 7.3 機能固有制約

（分類.mdの「C. 機能固有」セクションを参照）

---

## 8. Anti-Hallucination（出力タイプ別）

### 8.1 共通禁止事項（全出力タイプで推奨）

```yaml
# ====================================================
# Anti-Hallucination
# ====================================================
anti_hallucination:
  - "Do NOT alter character design from reference images"
  - "Do NOT add elements not specified in the instructions"
```

### 8.2 三面図系共通禁止事項 (01, 02, 03)

```yaml
anti_hallucination:
  - "Side view MUST NOT show both eyes - if both eyes are visible, it is NOT a correct profile"
  - "Do NOT change the view order - ALWAYS front/side/back from left to right"
  - "Do NOT change the face from the reference"
  - "Do NOT alter body proportions"
```

### 8.3 機能固有禁止事項

（分類.mdの「C. 機能固有」セクションを参照）

---

## 9. Output Cleanliness（全共通）

```yaml
# ====================================================
# Output Cleanliness
# ====================================================
output_cleanliness:
  - "Output ONLY the [対象] - nothing else"
  - "Do NOT add any text, titles, labels, or annotations"
  - "Do NOT add color palettes, color swatches, or color samples"
  - "Do NOT add arrows, lines, or any explanatory graphics"
  - "Do NOT add watermarks, signatures, or logos"
  - "The output must contain ONLY [対象] on [背景]"
```

### [対象]と[背景]の置換表

| 出力タイプ | [対象] | [背景] |
|-----------|--------|--------|
| 01 | the face reference sheet | white background |
| 02 | the body reference sheet | white background |
| 03 | the outfit reference sheet | white background |
| 04 | the character illustration | specified background |
| 05 | the scene illustration | specified background |
| 06 | the background image | (なし) |
| 07 | the decorative text | transparent background |
| 08 | the manga panels | white background |
| 09 | the transformed character | specified background |
| 10 | the infographic | specified background |

---

## セクション順序まとめ

```
1. 冒頭説明コメント           ← 全共通
2. Title Elements            ← 全共通
3. Title Overlay             ← 全共通
4. Style Settings            ← 全共通
5. 機能固有セクション          ← 出力タイプにより異なる
6. Generation Instructions   ← 08, 10のみ
7. Constraints               ← 三面図系共通 + 機能固有
8. Anti-Hallucination        ← 三面図系共通 + 機能固有
9. Output Cleanliness        ← 全共通（対象/背景のみ置換）
```

---

## 10. ジェネレーター選択マップ（Step 4）

各ジェネレーターがマスターテンプレートのどのセクションを使用するかを示す。

### 10.1 セクション使用一覧

| セクション | 01 顔 | 02 素体 | 03 衣装 | 04 ポーズ | 05 シーン | 06 背景 | 07 装飾 | 08 4コマ | 09 変換 | 10 インフォ |
|-----------|:-----:|:------:|:------:|:-------:|:-------:|:------:|:------:|:-------:|:------:|:---------:|
| 1. 冒頭説明 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 2. Title Elements | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | - | ✅ | ✅ | ✅ |
| 3. Title Overlay | ✅ | ✅ | ✅ | ✅ | - | ✅ | - | ✅ | - | ✅ |
| 4. Style Settings | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 5. 機能固有 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 6. Generation Inst | - | - | - | - | - | - | - | ✅ | - | ✅ |
| 7. Constraints | ✅ | ✅ | ✅ | ✅ | - | ✅ | ✅ | - | ✅ | ✅ |
| 8. Anti-Halluc | ✅ | ✅ | ✅ | ✅ | - | - | - | - | ✅ | ✅ |
| 9. Output Clean | ✅ | ✅ | ✅ | ✅ | - | ✅ | - | - | ✅ | - |

**凡例:** ✅ = 使用する、- = 使用しない

### 10.2 Constraints使用パターン

| 出力タイプ | 三面図系共通 | 機能固有 |
|-----------|:----------:|:-------:|
| 01 顔三面図 | ✅ | ✅ (face_specific) |
| 02 素体三面図 | ✅ | ✅ (body_specific) |
| 03 衣装着用 | ✅ | ✅ (outfit_specific) |
| 04 ポーズ | - | ✅ |
| 05 シーンビルダー | - | - |
| 06 背景生成 | - | ✅ |
| 07 装飾テキスト | - | ✅ |
| 08 4コマ漫画 | - | - |
| 09 スタイル変換 | - | ✅ |
| 10 インフォグラフィック | - | ✅ |

### 10.3 Title Elements詳細

| 出力タイプ | type | title | author |
|-----------|------|:-----:|:------:|
| 01 顔三面図 | character_design | ✅ | ✅ |
| 02 素体三面図 | body_reference_sheet | ✅ | ✅ |
| 03 衣装着用 | outfit_reference_sheet | ✅ | ✅ |
| 04 ポーズ | pose_illustration | ✅ | ✅ |
| 05 シーンビルダー | scene_illustration | - | - |
| 06 背景生成 | background_generation | ✅ | ✅ |
| 07 装飾テキスト | decorative_text | - | - |
| 08 4コマ漫画 | four_panel_manga | ✅ | ✅ |
| 09 スタイル変換 | style_transform | ✅ | ✅ |
| 10 インフォグラフィック | infographic | ✅ | ✅ |

**注:** 07装飾テキストはtype/title/authorを持たず、直接テキスト設定を行う。05シーンビルダーはトップレベルにtitle/authorを持たない構造。

### 10.4 Style Settings詳細

| 出力タイプ | color_mode | duotone_style | output_style | aspect_ratio |
|-----------|:----------:|:-------------:|:------------:|:------------:|
| 01 顔三面図 | ✅ | ✅ | ✅ | ✅ |
| 02 素体三面図 | ✅ | ✅ | ✅ | ✅ |
| 03 衣装着用 | ✅ | ✅ | ✅ | ✅ |
| 04 ポーズ | ✅ | ✅ | ✅ | ✅ |
| 05 シーンビルダー | ✅ | ✅ | ✅ | ✅ |
| 06 背景生成 | ✅ | ✅ | ✅ | ✅ |
| 07 装飾テキスト | ✅ | ✅ | - | - |
| 08 4コマ漫画 | ✅ | ✅ | ✅ | - |
| 09 スタイル変換 | ✅ | ✅ | - | - |
| 10 インフォグラフィック | ✅ | ✅ | ✅ | ✅ |

**注:** duotone_styleはcolor_mode="duotone"の場合のみ出力される条件付きフィールド。

### 10.5 特記事項

| 出力タイプ | 特記事項 |
|-----------|---------|
| 01 顔三面図 | 三面図系共通Constraints + face_specific制約 |
| 02 素体三面図 | 三面図系共通Constraints + body_specific制約 |
| 03 衣装着用 | 三面図系共通Constraints + フィットモード別制約（3種類） |
| 05 シーンビルダー | 独自の`decorative_text_overlays`セクションあり（title_overlayとは別） |
| 06 背景生成 | 2モード（参考画像あり/なし）で別々のYAML構造 |
| 07 装飾テキスト | 6種類のスタイルで別々のYAML構造、type/title/authorなし |
| 08 4コマ漫画 | YAML外に固定ヘッダー（日英指示文）、Constraints/Anti-Halluc/Output Cleanなし |
| 09 スタイル変換 | 2モード（透過背景あり/なし）で別々のYAML構造 |
| 10 インフォグラフィック | promptフィールドで動的指示文生成、Output Cleanなし |
