{{> header header_comment="Multi Panel Manga (漫画作成)"}}

# ====================================================
# Main Prompt and Layout (メインプロンプトとレイアウト)
# ====================================================
main_prompt:
  - "以下のYAML指示に従って、{{panel_count}}コマ漫画を1枚の画像として生成してください。"
  - "添付したキャラクター画像を参考に、キャラクターの外見を一貫させてください。"
  - "Generate a {{panel_count}}-panel manga as a single image following the YAML instructions below."
  - "Use the attached character images to maintain consistent character appearances."

layout_instruction:
  - "漫画を縦1列に配置してください。"
  - "横並びにせず、上から下へ1コマずつ縦に並べてください。"
  - "出力画像は縦長で、漫画だけが画像全体を占めるようにしてください。"
  - "余白は不要です。"
  - "各キャラクターの外見は添付画像を忠実に再現してください。"
  - "セリフは吹き出しで表示してください。"
  - "ナレーションは各コマの指定位置に表示してください（narration_position参照）。"

# ====================================================
# Narration Positioning Rules (ナレーション配置ルール)
# ====================================================
narration_rules:
  position_types:
    auto: "AI judges the best position for the narration"
    top: "Place narration at the TOP of the panel (horizontal text)"
    bottom: "Place narration at the BOTTOM of the panel (horizontal text)"
    right: "Place narration on the RIGHT side of the panel (VERTICAL text, Japanese style)"
    left: "Place narration on the LEFT side of the panel (VERTICAL text, Japanese style)"
  orientation:
    horizontal: "Text flows left-to-right (for top/bottom positions)"
    vertical: "Text flows top-to-bottom (for right/left positions, traditional Japanese manga style)"
  styling:
    - "Narration should be displayed in a text box or caption style"
    - "Use a semi-transparent background for readability"
    - "Vertical text should use proper Japanese vertical typography"

# ====================================================
# Character Positioning Rules (キャラ配置ルール)
# ====================================================
positioning_rules:
  principle:
    - "Each panel specifies character positions using 'position' field"
    - "Position can be absolute (left/center/right) or relative (to the right of [name])"
    - "Scene description also contains position information for reinforcement"
  solo:
    - "Single character uses 'center' position"
    - "Use 'solo' tag to prevent additional characters"
  duo:
    - "First character: absolute position 'on the left side'"
    - "Second character: relative position 'to the immediate right of [first character name]'"
    - "Use 'duo' tag to enforce 2-person composition"
  trio:
    - "First character: 'on the left side'"
    - "Second character: 'center' (NOT relative to first)"
    - "Third character: 'on the right side'"
    - "Use 'trio' tag to enforce 3-person composition"
  with_crowd:
    - "When has_mob_characters is true, draw background crowd/pedestrians"
    - "Use 'crowd', 'many people', 'depth of field' tags"
    - "Do NOT use solo/duo/trio tags when crowd is present"
    - "Main characters remain in focus, crowd is blurred background"

# ====================================================
# Panel Count (コマ数)
# ====================================================
panel_count: {{panel_count}}

# ====================================================
# Panels (各コマの内容)
# ====================================================
{{panels_content}}

# ====================================================
# Constraints (CRITICAL)
# ====================================================
constraints:
  character_rendering:
    - "Preserve exact character appearance from input images"
    - "Apply the specified features (expression, pose) to each character"
    - "Maintain character identity across all panels"
  character_positioning:
    - "Follow the 'position' field for each character strictly"
    - "Absolute positions: 'on the left side', 'center', 'on the right side'"
    - "Relative positions: 'to the immediate right of [name]'"
    - "Scene description reinforces positioning - follow it"
  person_count:
    - "The 'tags' field specifies exact person count"
    - "'solo' = exactly 1 person, no extras"
    - "'duo' = exactly 2 people, no extras"
    - "'trio' = exactly 3 people, no extras"
    - "'crowd' = main characters + background people (blurred)"
  panel_layout:
    - "Arrange panels vertically from top to bottom"
    - "Each panel should have clear boundaries"
  dialogue_rules:
    - "Display dialogue in speech bubbles near the speaking character"
    - "Position dialogue appropriately within the panel"
  narration_rules:
    - "Follow the 'narration_position' field for each panel"
    - "If narration_position is 'auto' or not specified, AI chooses the best position"
    - "If narration_position is 'top' or 'bottom', use horizontal text"
    - "If narration_position is 'right' or 'left', use VERTICAL text (縦書き)"
    - "Follow the 'narration_orientation' field for text direction"
  transparency_handling:
    - "Recognize checkerboard patterns in character images as TRANSPARENT backgrounds"
    - "Remove/ignore the transparent background area so only the character is visible"

# ====================================================
# Anti-Hallucination (MUST FOLLOW)
# ====================================================
anti_hallucination:
  - "Do NOT alter character designs from input images"
  - "Do NOT add characters not specified in the panel (unless 'crowd' tag is present)"
  - "Do NOT change dialogue text"
  - "Do NOT change narration text"
  - "Do NOT swap character positions - follow 'position' field exactly"
  - "Do NOT ignore 'tags' field - it controls person count"
  - "Do NOT ignore 'narration_position' field - it controls narration placement"
  - "Do NOT use horizontal text when 'narration_orientation' is 'vertical'"

# ====================================================
# Output Cleanliness (CRITICAL)
# ====================================================
output_cleanliness:
  - "Output ONLY the manga panels - nothing else"
  - "Do NOT add watermarks, signatures, or logos"
  - "Do NOT add extra decorative elements outside panels"
