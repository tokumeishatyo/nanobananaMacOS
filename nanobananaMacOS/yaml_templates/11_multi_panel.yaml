{{> header header_comment="Multi Panel Manga (漫画作成)"}}

# ====================================================
# Main Prompt and Layout (メインプロンプトとレイアウト)
# ====================================================
main_prompt:
  - "以下のYAML指示に従って、{{panel_count}}コマ漫画を1枚の画像として生成してください。"
  - "添付したキャラクター画像を参考に、キャラクターの外見を一貫させてください。"
  - "Generate a {{panel_count}}-panel manga as a single image following the YAML instructions below."
  - "Use the attached character images to maintain consistent character appearances."

layout_instruction:
  - "漫画を縦1列に配置してください。"
  - "横並びにせず、上から下へ1コマずつ縦に並べてください。"
  - "出力画像は縦長で、漫画だけが画像全体を占めるようにしてください。"
  - "余白は不要です。"
  - "各キャラクターの外見は添付画像を忠実に再現してください。"
  - "セリフは吹き出しで表示してください。"
  - "各コマのpositioning_ruleとnarration_ruleに従ってください。"

# ====================================================
# Panel Count (コマ数)
# ====================================================
panel_count: {{panel_count}}

# ====================================================
# Panels (各コマの内容)
# ====================================================
{{panels_content}}

# ====================================================
# Assembly Logic (AIへの合成指示)
# ====================================================
# 顔画像（face_reference）と衣装三面図（outfit_reference）を組み合わせてキャラクターを描画
instructions:
  - "Compose the image by applying the 'outfit_reference' (Outfit Reference) onto the 'face_reference' (Face Reference)."
  - "STRICTLY maintain the character's facial features from the face_reference image."
  - "STRICTLY maintain the outfit's design and structure from the outfit_reference image."
  - "The outfit_reference is a 'Ghost Mannequin' view. Fit this clothing naturally onto the character's body."
  - "If 'features' field specifies color/texture variations, apply them while keeping the design shape."
  - "Ensure consistent art style across all panels."

# ====================================================
# Constraints (CRITICAL)
# ====================================================
constraints:
  character_rendering:
    - "Preserve exact character appearance from input images"
    - "Apply the specified features (expression, pose) to each character"
    - "Maintain character identity across all panels"
  character_positioning:
    - "Follow the 'position' field for each character strictly"
    - "Absolute positions: 'on the left side', 'center', 'on the right side'"
    - "Relative positions: 'to the immediate right of [name]'"
    - "Scene description reinforces positioning - follow it"
  person_count:
    - "The 'tags' field specifies exact person count"
    - "'solo' = exactly 1 person, no extras"
    - "'duo' = exactly 2 people, no extras"
    - "'trio' = exactly 3 people, no extras"
    - "'crowd' = main characters + background people"
    - "'crowd' with 'depth of field' = background people are blurred"
    - "'crowd' with 'sharp focus' = background people are clearly drawn"
  panel_layout:
    - "Arrange panels vertically from top to bottom"
    - "Each panel should have clear boundaries"
  dialogue_rules:
    - "Display dialogue in speech bubbles near the speaking character"
    - "Position dialogue appropriately within the panel"
  narration_rules:
    - "Follow the 'narration_rule' field in each panel for narration placement"
    - "Each panel specifies its own narration position and text orientation"
  transparency_handling:
    - "Recognize checkerboard patterns in character images as TRANSPARENT backgrounds"
    - "Remove/ignore the transparent background area so only the character is visible"

# ====================================================
# Anti-Hallucination (MUST FOLLOW)
# ====================================================
anti_hallucination:
  - "Do NOT alter character designs from input images"
  - "Do NOT add characters not specified in the panel (unless 'crowd' tag is present)"
  - "Do NOT change dialogue text"
  - "Do NOT change narration text"
  - "Do NOT swap character positions - follow 'position' field exactly"
  - "Do NOT ignore 'tags' field - it controls person count"
  - "Do NOT ignore 'narration_position' field - it controls narration placement"
  - "Do NOT use horizontal text when 'narration_orientation' is 'vertical'"

# ====================================================
# Output Cleanliness (CRITICAL)
# ====================================================
output_cleanliness:
  - "Output ONLY the manga panels - nothing else"
  - "Do NOT add watermarks, signatures, or logos"
  - "Do NOT add extra decorative elements outside panels"
