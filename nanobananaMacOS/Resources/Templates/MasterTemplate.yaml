# ============================================================
# AI創作工房 マスターテンプレート
# ============================================================
# このファイルはYAML生成のテンプレートを定義します。
# テンプレート構文:
#   {{variable}}        - 変数置換
#   {{#if condition}}   - 条件分岐開始
#   {{else}}            - else節
#   {{/if}}             - 条件分岐終了
#   {{#each array}}     - ループ開始
#   {{/each}}           - ループ終了
#   {{@index}}          - ループインデックス（0始まり）
#   {{@index_1}}        - ループインデックス（1始まり）
# ============================================================

version: "1.0"

# ============================================================
# 共通セクション定義
# ============================================================
common_sections:

  # ----------------------------------------------------------
  # 1. 冒頭説明コメント
  # ----------------------------------------------------------
  header:
    description: "YAML冒頭の説明コメント"
    template: |
      # {{header_title_ja}} ({{header_title_en}})

  # ----------------------------------------------------------
  # 2. Title Elements (type, title, author)
  # ----------------------------------------------------------
  title_elements:
    description: "type, title, authorの基本情報"
    template: |
      type: {{type}}
      title: "{{title}}"{{#if author}}
      author: "{{author}}"{{/if}}
      {{! Note: This is the common template. Face sheet uses this with type=character_design }}

  # ----------------------------------------------------------
  # 3. Title Overlay
  # ----------------------------------------------------------
  title_overlay:
    description: "画像上にタイトル・作者名を表示する設定"
    template: |
      {{#if title_overlay_enabled}}

      # ====================================================
      # Title Overlay
      # ====================================================
      title_overlay:
        enabled: true
        text: "{{title}}"{{#if author}}
        author: "{{author}}"{{/if}}
        position: "top_center"
        style: "elegant"
      {{/if}}

  # ----------------------------------------------------------
  # 4. Style Settings
  # ----------------------------------------------------------
  style_settings:
    description: "カラーモード、出力スタイル、アスペクト比"
    template: |
      style:
        color_mode: "{{color_mode}}"{{#if is_duotone}}
        duotone_style: "{{duotone_style}}"{{/if}}{{#if output_style}}
        output_style: "{{output_style}}"{{/if}}{{#if aspect_ratio}}
        aspect_ratio: "{{aspect_ratio}}"{{/if}}

  # ----------------------------------------------------------
  # 7. Constraints (三面図系共通)
  # ----------------------------------------------------------
  constraints_three_view:
    description: "三面図系共通の制約"
    template: |
      constraints:
        layout:
          - "Each view should be clearly separated with white space"
          - "All views same size and scale"
          - "Clean linework suitable for reference"
        side_view:
          - "Side view MUST be exactly 90-degree profile"
          - "Side view MUST show LEFT side (character facing left)"
          - "Side view: only ONE eye visible"
          - "Side view: nose points directly to the left edge, ear fully visible"

  # ----------------------------------------------------------
  # 8. Anti-Hallucination (三面図系共通)
  # ----------------------------------------------------------
  anti_hallucination_three_view:
    description: "三面図系共通の禁止事項"
    template: |
      anti_hallucination:
        - "Side view MUST NOT show both eyes - if both eyes are visible, it is NOT a correct profile"
        - "Do NOT change the view order"
        - "Do NOT change the face from the reference"
        - "Do NOT alter body proportions"
        - "Do NOT add any text or labels to the image"
        - "Do NOT add borders or frames around views"

  # ----------------------------------------------------------
  # 9. Output Cleanliness
  # ----------------------------------------------------------
  output_cleanliness:
    description: "出力の清潔さに関する制約"
    template: |
      output_cleanliness:
        - "Output ONLY the {{output_target}} - nothing else"
        - "Do NOT add any text, titles, labels, or annotations"
        - "Do NOT add color palettes, color swatches, or color samples"
        - "Do NOT add arrows, lines, or any explanatory graphics"
        - "Do NOT add watermarks, signatures, or logos"
        - "The output must contain ONLY {{output_target}} on {{output_background}}"

# ============================================================
# 出力タイプ別セクション定義
# ============================================================
output_types:

  # ==========================================================
  # 01 顔三面図 (Face Sheet)
  # ==========================================================
  face_sheet:
    header_values:
      header_title_ja: "顔三面図"
      header_title_en: "Face Character Reference Sheet"
      type: "character_design"
    output_values:
      output_target: "the face reference sheet"
      output_background: "white background"

    sections:
      output_type:
        template: |
          output_type: "face character reference sheet"

      layout:
        template: |
          # ====================================================
          # IMPORTANT: Face Reference Sheet Layout
          # ====================================================
          # Layout: Triangular arrangement (inverted triangle)
          #
          #   [FRONT VIEW]     [3/4 LEFT VIEW]
          #         [LEFT PROFILE]
          #
          # All views facing LEFT direction for consistency
          # ====================================================

          layout:
            arrangement: "triangular, inverted triangle formation"
            direction: "all views facing LEFT"
            top_row:
              - position: "top-left"
                view: "front view, facing directly at camera, eyes looking at viewer"
              - position: "top-right"
                view: "3/4 left view, head turned 45 degrees to the left, showing left side of face"
            bottom_row:
              - position: "bottom-center"
                view: "left profile, exactly 90-degree side view, face perpendicular to camera, only one eye visible, nose pointing directly left, ear fully visible"

      headshot_specification:
        template: |
          headshot_specification:
            type: "Character design base body (sotai) headshot for reference sheet"
            coverage: "From top of head to base of neck (around collarbone level)"
            clothing: "NONE - Do not include any clothing or accessories"
            accessories: "NONE - No jewelry, headwear, or decorations"
            state: "Clean base body state only"
            background: "Pure white background, seamless"
            purpose: "Professional character design reference for commercial use - product catalogs, instruction manuals, educational materials, corporate training. This is legitimate business artwork, NOT inappropriate content."

      character:
        template: |
          character:
            name: "{{character_name}}"
            description: "{{character_description}}"
            outfit: "NONE - bare skin only, no clothing"
            expression: "{{expression}}"

      character_style:
        template: |
          character_style:
            style: "{{style_info_style}}"
            proportions: "{{style_info_proportions}}"
            style_description: "{{style_info_description}}"

      output:
        template: |
          # ====================================================
          # Output Specifications
          # ====================================================
          output:
            format: "reference sheet with multiple views"
            views: "front view, 3/4 view, side profile"
            background: "pure white, clean, seamless, no borders"
            text_overlay: "NONE - absolutely no text, labels, or titles on the image"

      constraints:
        template: |
          # ====================================================
          # Constraints (Critical)
          # ====================================================
          constraints:
            layout:
              - "Triangular arrangement: front view top-left, 3/4 left view top-right, left profile bottom-center"
              - "All angled views must face LEFT direction"
              - "Each view should be clearly separated with white space"
              - "All views same size and scale"
            design:
              - "Maintain consistent design across all views"
              - "Pure white background for clarity"
              - "Clean linework suitable for reference"
            face_specific:
              - "HEAD/FACE ONLY - show from top of head to neck/collarbone"
              - "Do NOT draw any clothing, accessories, or decorations"
              - "Keep the character in clean base body state"
              - "Neutral expression, emotionless"
              - "3/4 view: head turned 45 degrees to the LEFT"
              - "Profile view: MUST be exactly 90-degree side view facing LEFT"
              - "Profile view: only ONE eye should be visible (the right eye hidden behind face)"
              - "Profile view: nose must point directly to the left edge"
              - "Profile view: ear must be fully visible"

      anti_hallucination:
        template: |
          # ====================================================
          # Anti-Hallucination (MUST FOLLOW)
          # ====================================================
          anti_hallucination:
            - "Do NOT add any text or labels to the image"
            - "Do NOT include character names on the image"
            - "Do NOT add view labels like 'FRONT VIEW' or 'SIDE VIEW'"
            - "Do NOT add borders or frames around views"
            - "Do NOT add any decorative elements"
            - "Output ONLY the character views on white background"
            - "Profile view MUST NOT show both eyes - if both eyes are visible, it is NOT a correct profile"

      output_cleanliness:
        template: |
          # ====================================================
          # Output Cleanliness (CRITICAL)
          # ====================================================
          output_cleanliness:
            - "Output ONLY the character illustration - nothing else"
            - "Do NOT add any text, titles, labels, or annotations"
            - "Do NOT add color palettes, color swatches, or color samples"
            - "Do NOT add pattern samples, fabric swatches, or design elements"
            - "Do NOT add arrows, lines, or any explanatory graphics"
            - "Do NOT add watermarks, signatures, or logos"
            - "The output must contain ONLY the character illustration on white background"

      style:
        template: |
          style:
            color_mode: "{{color_mode}}"{{#if is_duotone}}
            duotone_style: "{{duotone_style}}"{{/if}}
            aspect_ratio: "1:1"

      reference_image:
        template: |
          {{#if reference_image_path}}reference_image: "{{reference_image_path}}"{{/if}}

  # ==========================================================
  # 02 素体三面図 (Body Sheet)
  # ==========================================================
  body_sheet:
    header_values:
      header_title_ja: "素体三面図"
      header_title_en: "Body Reference Sheet"
      type: "body_reference_sheet"
    output_values:
      output_target: "the body reference sheet"
      output_background: "white background"

    sections:
      output_type:
        template: |
          output_type: "full body character reference sheet"

      input:
        template: |
          # ====================================================
          # Input: Face Reference
          # ====================================================
          face_reference:
            image: "{{face_sheet_path}}"
            instruction: "Use the exact face from this reference image - maintain all facial features, proportions, and characteristics"

      layout:
        template: |
          # ====================================================
          # Layout: Horizontal Three-View
          # ====================================================
          # [FRONT] [LEFT SIDE] [BACK]
          # All views showing full body from head to toe
          # ====================================================

          layout:
            arrangement: "horizontal row layout"
            direction: "all views facing LEFT for consistency"
            positions:
              - position: "left"
                view: "front view (facing camera)"
              - position: "center"
                view: "left side profile (90-degree side view, facing left)"
              - position: "right"
                view: "back view (facing away from camera)"

      body_specification:
        template: |
          body_specification:
            type: "Full body character reference (sotai/base body)"
            coverage: "Complete figure from head to feet"
            clothing: "NONE - completely nude base body"
            state: "Clean anatomical reference state"
            background: "Pure white background"
            pose: "Standing straight, arms slightly away from body, legs shoulder-width apart"

      character:
        template: |
          character:
            name: "{{character_name}}"
            body_type: "{{body_type}}"
            bust_description: "{{bust_description}}"
            expression_type: "{{expression_type}}"
            description: "{{character_description}}"

      character_style:
        template: |
          character_style:
            style: "{{style_info_style}}"
            proportions: "{{style_info_proportions}}"
            style_description: "{{style_info_description}}"

      output:
        template: |
          output:
            format: "reference sheet with three views"
            views: "front, side profile, back"
            background: "pure white"

      constraints:
        template: |
          # ====================================================
          # Constraints (Critical)
          # ====================================================
          constraints:
            layout:
              - "Horizontal arrangement: front left, side center, back right"
              - "Each view clearly separated"
              - "All views same scale"
            body_specific:
              - "FULL BODY - head to toe in all views"
              - "NO clothing or accessories"
              - "Side view MUST be exactly 90-degree profile facing LEFT"
              - "Side view: only ONE eye visible"
              - "Consistent body proportions across all views"

      anti_hallucination:
        template: |
          # ====================================================
          # Anti-Hallucination
          # ====================================================
          anti_hallucination:
            - "Do NOT add any clothing or accessories"
            - "Do NOT change the face from the reference"
            - "Do NOT add text or labels"
            - "Profile view MUST NOT show both eyes"

      output_cleanliness:
        template: |
          # ====================================================
          # Output Cleanliness
          # ====================================================
          output_cleanliness:
            - "Output ONLY the body reference sheet"
            - "Do NOT add any text, labels, or annotations"
            - "Do NOT add color palettes or swatches"
            - "ONLY the character on white background"

      style:
        template: |
          style:
            color_mode: "{{color_mode}}"{{#if is_duotone}}
            duotone_style: "{{duotone_style}}"{{/if}}
            output_style: "{{output_style}}"
            aspect_ratio: "{{aspect_ratio}}"

  # ==========================================================
  # 03 衣装着用三面図 (Outfit Sheet)
  # ==========================================================
  outfit_sheet:
    header_values:
      header_title_ja: "衣装着用三面図"
      header_title_en: "Outfit Reference Sheet"
      type: "outfit_reference_sheet"
    output_values:
      output_target: "the outfit reference sheet"
      output_background: "white background"

    sections:
      output_type:
        template: |
          output_type: "outfit character reference sheet"

      input:
        template: |
          # ====================================================
          # Input: Body Reference
          # ====================================================
          body_reference:
            image: "{{body_sheet_path}}"
            instruction: "Use the exact body from this reference - maintain all physical features"

      outfit_specification:
        description: "プリセットモード用"
        template: |
          # ====================================================
          # Outfit Specification
          # ====================================================
          outfit:
            category: "{{outfit_category}}"
            shape: "{{outfit_shape}}"
            color: "{{outfit_color}}"
            pattern: "{{outfit_pattern}}"
            impression: "{{outfit_impression}}"

      outfit_reference:
        description: "参考画像モード用"
        template: |
          # ====================================================
          # Outfit Reference Image
          # ====================================================
          outfit_reference:
            image: "{{outfit_image_path}}"
            fit_mode: "{{fit_mode}}"
            include_headwear: {{include_headwear}}

      layout:
        template: |
          layout:
            arrangement: "horizontal row layout"
            positions:
              - position: "left"
                view: "front view"
              - position: "center"
                view: "left side profile"
              - position: "right"
                view: "back view"

      style:
        template: |
          style:
            color_mode: "{{color_mode}}"{{#if is_duotone}}
            duotone_style: "{{duotone_style}}"{{/if}}
            output_style: "{{output_style}}"
            aspect_ratio: "{{aspect_ratio}}"

  # ==========================================================
  # 04 ポーズ (Pose)
  # ==========================================================
  pose:
    header_values:
      header_title_ja: "ポーズ"
      header_title_en: "Pose Illustration"
      type: "pose_illustration"
    output_values:
      output_target: "the character illustration"
      output_background: "specified background"

    sections:
      input:
        template: |
          # ====================================================
          # Input: Outfit Reference
          # ====================================================
          outfit_reference:
            image: "{{outfit_sheet_path}}"
            instruction: "Use this character with their outfit exactly as shown"

      pose_preset:
        description: "プリセットモード用"
        template: |
          # ====================================================
          # Pose Configuration
          # ====================================================
          pose:
            preset: "{{pose_preset}}"
            camera_angle: "{{camera_angle}}"

      pose_reference:
        description: "参考画像モード用"
        template: |
          # ====================================================
          # Pose Reference
          # ====================================================
          pose_reference:
            image: "{{pose_image_path}}"
            instruction: "Capture the pose from this reference image"

      scene:
        template: |
          scene:
            background: "{{background_description}}"
            lighting: "{{lighting}}"

      output:
        template: |
          output:
            format: "single character illustration"
            style: "anime illustration"

      constraints:
        template: |
          # ====================================================
          # CRITICAL CONSTRAINTS
          # ====================================================
          constraints:
            - "Maintain EXACT character appearance from outfit reference"
            - "Keep outfit details consistent"
            - "Apply pose naturally while preserving character design"

      anti_hallucination:
        template: |
          anti_hallucination:
            - "Do NOT change the character's face"
            - "Do NOT alter the outfit design"
            - "Do NOT add accessories not in the reference"

      output_cleanliness:
        template: |
          output_cleanliness:
            - "Output ONLY the character illustration"
            - "Do NOT add text or labels"

      style:
        template: |
          style:
            color_mode: "{{color_mode}}"{{#if is_duotone}}
            duotone_style: "{{duotone_style}}"{{/if}}
            output_style: "{{output_style}}"
            aspect_ratio: "{{aspect_ratio}}"

  # ==========================================================
  # 05 シーンビルダー (Scene Builder)
  # ==========================================================
  scene_builder:
    header_values:
      header_title_ja: "シーンビルダー"
      header_title_en: "Scene Composition"
      type: "story_scene_composition"

    sections:
      # シーンビルダーは独自の構造を持つ
      # 詳細は別途定義

  # ==========================================================
  # 06 背景生成 (Background)
  # ==========================================================
  background:
    header_values:
      header_title_ja: "背景生成"
      header_title_en: "Background Generation"
      type: "background_generation"
    output_values:
      output_target: "the background image"
      output_background: ""

    sections:
      input_with_reference:
        template: |
          # ====================================================
          # Input: Reference Image
          # ====================================================
          reference_image:
            image: "{{reference_image_path}}"
            instruction: "Transform this reference into a background"

      input_without_reference:
        template: |
          # Background will be generated from description only

      description:
        template: |
          # ====================================================
          # Background Description
          # ====================================================
          background:
            description: "{{background_description}}"

      constraints:
        template: |
          # ====================================================
          # CRITICAL CONSTRAINTS
          # ====================================================
          constraints:
            - "Generate ONLY a background - NO characters, people, or figures"
            - "Create an environment/setting only"

      output_cleanliness:
        template: |
          output_cleanliness:
            - "Output ONLY the background image"
            - "Do NOT include any characters or figures"
            - "Do NOT add text or labels"

      style:
        template: |
          style:
            color_mode: "{{color_mode}}"{{#if is_duotone}}
            duotone_style: "{{duotone_style}}"{{/if}}
            output_style: "{{output_style}}"
            aspect_ratio: "{{aspect_ratio}}"

  # ==========================================================
  # 07 装飾テキスト (Decorative Text)
  # ==========================================================
  decorative_text:
    header_values:
      header_title_ja: "装飾テキスト"
      header_title_en: "Decorative Text"
      type: "decorative_text"

    sections:
      # 装飾テキストは6種類のスタイルで異なるテンプレートを持つ
      # 詳細は別途定義

  # ==========================================================
  # 08 4コマ漫画 (Four Panel)
  # ==========================================================
  four_panel:
    header_values:
      header_title_ja: "4コマ漫画"
      header_title_en: "Four Panel Manga"
      type: "four_panel_manga"
    has_generation_instructions: true

    sections:
      generation_instructions:
        template: |
          【画像生成指示 / Image Generation Instructions】
          以下のYAML指示に従って、4コマ漫画を1枚の画像として生成してください。
          添付したキャラクター設定画を参考に、キャラクターの外見を一貫させてください。

          Generate a 4-panel manga as a single image following the YAML instructions below.
          Use the attached character reference sheets to maintain consistent character appearances.

          ---

      title_elements:
        template: |
          # 4コマ漫画生成 (four_panel_manga.yaml準拠)
          title: "{{title}}"{{#if author}}
          author: "{{author}}"{{/if}}
          color_mode: "{{color_mode}}"{{#if is_duotone}}
          duotone_style: "{{duotone_style}}"{{/if}}
          output_style: "{{output_style}}"

      characters:
        template: |
          # 登場人物
          characters:{{#each characters}}
            - name: "{{name}}"
              reference: "{{reference}}"
              description: "{{description}}"{{/each}}

      panels:
        template: |
          # 4コマの内容
          panels:{{#each panels}}
            # --- {{panel_number}}コマ目（{{label}}）---
            - panel_number: {{panel_number}}
              prompt: "{{prompt}}"
              speeches:{{#each speeches}}
                - character: "{{character}}"
                  content: "{{content}}"
                  position: "{{position}}"{{/each}}{{#if narration}}
              narration: "{{narration}}"{{/if}}{{/each}}

      layout:
        template: |
          # レイアウト指示
          layout_instruction: |
            4コマ漫画を縦1列に配置してください。
            横並びにせず、上から下へ1コマずつ縦に4つ並べてください。
            出力画像は縦長（9:16または2:5の比率）で、4コマ漫画だけが画像全体を占めるようにしてください。
            余白は不要です。
            各キャラクターの外見は添付画像と説明を忠実に再現してください。
            セリフは吹き出しで表示し、指定された位置に配置してください。
            ナレーションがある場合は、コマの上部または下部にテキストボックスで表示してください。

  # ==========================================================
  # 09 スタイル変換 (Style Transform)
  # ==========================================================
  style_transform:
    header_values:
      header_title_ja: "スタイル変換"
      header_title_en: "Style Transform"
      type: "style_transform"
    output_values:
      output_target: "the transformed character"
      output_background: "specified background"

    sections:
      input:
        template: |
          # ====================================================
          # Input: Source Image
          # ====================================================
          source_image:
            image: "{{source_image_path}}"
            instruction: "Transform this image to the specified style"

      transform:
        template: |
          # ====================================================
          # Transform Configuration
          # ====================================================
          transform:
            target_style: "{{target_style}}"
            style_prompt: "{{style_prompt}}"

      preservation:
        template: |
          preservation:
            face_features: true
            outfit_details: true
            pose_action: true

      output_background:
        template: |
          output:
            background: "{{output_background}}"

      constraints:
        template: |
          # ====================================================
          # Constraints
          # ====================================================
          constraints:
            - "Maintain character identity during transformation"
            - "Keep face recognizable"
            - "Preserve outfit design elements"

      anti_hallucination:
        template: |
          anti_hallucination:
            - "Do NOT change the character's identity"
            - "Do NOT alter the basic outfit design"

      output_cleanliness:
        template: |
          output_cleanliness:
            - "Output ONLY the transformed character"
            - "Do NOT add text or labels"

      style:
        template: |
          style:
            color_mode: "{{color_mode}}"{{#if is_duotone}}
            duotone_style: "{{duotone_style}}"{{/if}}

  # ==========================================================
  # 10 インフォグラフィック (Infographic)
  # ==========================================================
  infographic:
    header_values:
      header_title_ja: "インフォグラフィック"
      header_title_en: "Infographic"
      type: "infographic"
    has_generation_instructions: true

    sections:
      title_elements:
        template: |
          # Infographic Generation
          type: infographic
          title: "{{title}}"{{#if author}}
          author: "{{author}}"{{/if}}

      configuration:
        template: |
          # ====================================================
          # Style Configuration
          # ====================================================
          infographic_style:
            type: "{{infographic_type}}"
            style_prompt: "{{style_prompt}}"
            output_language: "{{output_language}}"

      titles:
        template: |
          titles:
            main_title: "{{main_title}}"
            subtitle: "{{subtitle}}"

      main_character:
        template: |
          main_character:
            image: "{{character_image_path}}"
            position: "center"

      bonus_character:
        template: |
          {{#if bonus_character_enabled}}
          bonus_character:
            enabled: true
            image: "{{bonus_character_image_path}}"{{/if}}

      sections_content:
        template: |
          # ====================================================
          # Information Sections
          # ====================================================
          sections:{{#each info_sections}}
            - title: "{{title}}"
              content: "{{content}}"{{/each}}

      prompt:
        template: |
          # ====================================================
          # Generation Instructions
          # ====================================================
          prompt: |
            Create a detailed infographic about this person/character in {{infographic_type}} style.
            Use the attached character image as the central figure.
            Include extremely detailed information - small text is acceptable if it adds more detail.

            Style: {{style_prompt}}

            Main title: "{{main_title}}"
            Subtitle: "{{subtitle}}"

            Include these sections around the character:{{#each info_sections}}
            - {{title}}: {{content}}{{/each}}

            Output language: {{output_language}}

            IMPORTANT:
            - Create related icons and decorations automatically based on the content
            - Use the {{infographic_type}} visual style consistently
            - Make it visually engaging with colors, icons, and artistic elements
            - Include as much detail as possible in small organized sections

      constraints:
        template: |
          # ====================================================
          # Constraints
          # ====================================================
          constraints:
            - "Use the provided character image as the main central figure"
            - "Arrange information sections around the character"
            - "Create appropriate icons and decorations based on content"
            - "Output all text in {{output_language}}"
            - "Maintain {{infographic_type}} style throughout"

      anti_hallucination:
        template: |
          anti_hallucination:
            - "Do NOT change the character's appearance from the provided image"
            - "Do NOT omit any of the specified sections"
            - "Do NOT add unrelated information not in the sections"

      style:
        template: |
          style:
            color_mode: "{{color_mode}}"{{#if is_duotone}}
            duotone_style: "{{duotone_style}}"{{/if}}
            output_style: "{{output_style}}"
            aspect_ratio: "{{aspect_ratio}}"
